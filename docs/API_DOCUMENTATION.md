# Documentation API - Bloc-R

## üåê Base URL

```
http://localhost:8000/api
```

## üîê Authentification

L'API utilise Laravel Sanctum pour l'authentification. Tous les endpoints prot√©g√©s n√©cessitent un token d'authentification dans l'en-t√™te `Authorization`.

```
Authorization: Bearer {token}
```

## üìã Endpoints

### üîë Authentification

#### POST `/register`
Enregistrer un nouvel agent

**Param√®tres:**
```json
{
    "nom": "string (required)",
    "prenom": "string (required)",
    "email": "string (required, unique)",
    "password": "string (required, min:8)",
    "telephone": "string (required, max:10)",
    "photo": "file (optional, image, max:2MB)"
}
```

**R√©ponse:**
```json
{
    "access_token": "string",
    "user": {
        "id": 1,
        "nom": "Doe",
        "prenom": "John",
        "email": "john@example.com",
        "telephone": "1234567890",
        "photo": "photos/photo.jpg",
        "created_at": "2025-09-18T20:00:00.000000Z",
        "updated_at": "2025-09-18T20:00:00.000000Z"
    }
}
```

#### POST `/login`
Connexion d'un agent

**Param√®tres:**
```json
{
    "email": "string (required)",
    "password": "string (required)"
}
```

**R√©ponse:**
```json
{
    "access_token": "string",
    "user": {
        "id": 1,
        "nom": "Doe",
        "prenom": "John",
        "email": "john@example.com",
        "telephone": "1234567890",
        "photo": "photos/photo.jpg"
    }
}
```

#### POST `/logout` üîí
D√©connexion de l'agent

**R√©ponse:**
```json
{
    "message": "D√©connexion r√©ussie"
}
```

#### GET `/me` üîí
Obtenir les informations de l'agent connect√©

**R√©ponse:**
```json
{
    "id": 1,
    "nom": "Doe",
    "prenom": "John",
    "email": "john@example.com",
    "telephone": "1234567890",
    "photo": "photos/photo.jpg",
    "created_at": "2025-09-18T20:00:00.000000Z",
    "updated_at": "2025-09-18T20:00:00.000000Z"
}
```

### üë• Gestion des Militants

#### GET `/agents/militants` üîí
Lister tous les militants

**Param√®tres de requ√™te:**
- `status` (optional): Filtrer par statut (`active`, `inactive`, `suspended`)
- `status_paiement` (optional): Filtrer par statut de paiement (`paid`, `unpaid`, `pending`)
- `status_verification` (optional): Filtrer par statut de v√©rification (`en_cours`, `correct`, `refuse`, `corrige`)
- `search` (optional): Rechercher par nom, pr√©nom, email ou r√©f√©rence
- `page` (optional): Num√©ro de page pour la pagination

**Exemple:**
```
GET /api/agents/militants?status=active&search=john&page=1
```

**R√©ponse:**
```json
{
    "data": [
        {
            "id": 1,
            "nom": "Doe",
            "prenom": "John",
            "email": "john@example.com",
            "telephone": "1234567890",
            "photo": "photos/militant1.jpg",
            "status": "active",
            "date_inscription": "2025-09-18T20:00:00.000000Z",
            "reference_carte": "BLR-2025-001",
            "status_paiement": "paid",
            "status_verification": "correct",
            "user": {
                "id": 1,
                "nom": "Agent",
                "prenom": "Admin"
            },
            "circonscription": {
                "code_circ": 1,
                "lib_circ": "1ERE CIRCONSCRIPTION ELECTORALE"
            },
            "departement": {
                "code_dep": 1,
                "lib_dep": "ALIBORI"
            },
            "commune": {
                "code_com": 1,
                "lib_com": "BANIKOARA"
            },
            "created_at": "2025-09-18T20:00:00.000000Z",
            "updated_at": "2025-09-18T20:00:00.000000Z"
        }
    ],
    "links": {
        "first": "http://localhost:8000/api/agents/militants?page=1",
        "last": "http://localhost:8000/api/agents/militants?page=10",
        "prev": null,
        "next": "http://localhost:8000/api/agents/militants?page=2"
    },
    "meta": {
        "current_page": 1,
        "from": 1,
        "last_page": 10,
        "per_page": 15,
        "to": 15,
        "total": 150
    }
}
```

#### POST `/agents/militants` üîí
Cr√©er un nouveau militant

**Param√®tres:**
```json
{
    "nom": "string (required)",
    "prenom": "string (required)",
    "email": "string (required, unique)",
    "telephone": "string (optional)",
    "photo": "file (optional, image, max:2MB)",
    "circonscription_id": "integer (required)",
    "departement_id": "integer (required)",
    "commune_id": "integer (required)",
    "status_paiement": "string (optional, default: unpaid)",
    "motif_refus": "string (optional)"
}
```

**R√©ponse:**
```json
{
    "message": "Militant cr√©√© avec succ√®s",
    "militant": {
        "id": 1,
        "nom": "Doe",
        "prenom": "John",
        "email": "john@example.com",
        "telephone": "1234567890",
        "photo": "photos/militant1.jpg",
        "status": "active",
        "date_inscription": "2025-09-18T20:00:00.000000Z",
        "reference_carte": "BLR-2025-001",
        "status_paiement": "unpaid",
        "status_verification": "en_cours",
        "user_id": 1,
        "circonscription_id": 1,
        "departement_id": 1,
        "commune_id": 1,
        "created_at": "2025-09-18T20:00:00.000000Z",
        "updated_at": "2025-09-18T20:00:00.000000Z"
    }
}
```

#### GET `/agents/militants/{id}` üîí
Obtenir les d√©tails d'un militant

**R√©ponse:**
```json
{
    "id": 1,
    "nom": "Doe",
    "prenom": "John",
    "email": "john@example.com",
    "telephone": "1234567890",
    "photo": "photos/militant1.jpg",
    "status": "active",
    "date_inscription": "2025-09-18T20:00:00.000000Z",
    "reference_carte": "BLR-2025-001",
    "status_paiement": "paid",
    "status_verification": "correct",
    "removed": "no",
    "motif_refus": null,
    "status_impression": "printed",
    "user": {
        "id": 1,
        "nom": "Agent",
        "prenom": "Admin"
    },
    "circonscription": {
        "code_circ": 1,
        "lib_circ": "1ERE CIRCONSCRIPTION ELECTORALE",
        "lib_iso": "1ERE"
    },
    "departement": {
        "code_dep": 1,
        "lib_dep": "ALIBORI"
    },
    "commune": {
        "code_com": 1,
        "lib_com": "BANIKOARA"
    },
    "created_at": "2025-09-18T20:00:00.000000Z",
    "updated_at": "2025-09-18T20:00:00.000000Z"
}
```

#### PUT `/agents/militants/{id}` üîí
Mettre √† jour un militant

**Param√®tres:**
```json
{
    "nom": "string (optional)",
    "prenom": "string (optional)",
    "email": "string (optional, unique)",
    "telephone": "string (optional)",
    "photo": "file (optional, image, max:2MB)",
    "status": "string (optional)",
    "circonscription_id": "integer (optional)",
    "departement_id": "integer (optional)",
    "commune_id": "integer (optional)",
    "status_paiement": "string (optional)",
    "status_verification": "string (optional)",
    "motif_refus": "string (optional)"
}
```

**R√©ponse:**
```json
{
    "message": "Militant mis √† jour avec succ√®s",
    "militant": {
        "id": 1,
        "nom": "Doe",
        "prenom": "John",
        "email": "john@example.com",
        "telephone": "1234567890",
        "photo": "photos/militant1.jpg",
        "status": "active",
        "date_inscription": "2025-09-18T20:00:00.000000Z",
        "reference_carte": "BLR-2025-001",
        "status_paiement": "paid",
        "status_verification": "correct",
        "created_at": "2025-09-18T20:00:00.000000Z",
        "updated_at": "2025-09-18T20:00:00.000000Z"
    }
}
```

#### DELETE `/agents/militants/{id}` üîí
Supprimer un militant

**R√©ponse:**
```json
{
    "message": "Militant supprim√© avec succ√®s"
}
```

#### POST `/agents/militants/{id}/accept` üîí
Accepter une demande de militant

**R√©ponse:**
```json
{
    "message": "Demande accept√©e avec succ√®s",
    "militant": {
        "id": 1,
        "status_verification": "correct",
        "updated_at": "2025-09-18T20:00:00.000000Z"
    }
}
```

#### POST `/agents/militants/{id}/reject` üîí
Rejeter une demande de militant

**Param√®tres:**
```json
{
    "motif_refus": "string (required)"
}
```

**R√©ponse:**
```json
{
    "message": "Demande rejet√©e avec succ√®s",
    "militant": {
        "id": 1,
        "status_verification": "refuse",
        "motif_refus": "Documents incomplets",
        "updated_at": "2025-09-18T20:00:00.000000Z"
    }
}
```

#### GET `/agents/militants/{agent_id}` üîí
Obtenir les militants d'un agent sp√©cifique

**R√©ponse:**
```json
{
    "data": [
        {
            "id": 1,
            "nom": "Doe",
            "prenom": "John",
            "email": "john@example.com",
            "status": "active",
            "reference_carte": "BLR-2025-001",
            "created_at": "2025-09-18T20:00:00.000000Z"
        }
    ],
    "meta": {
        "total": 1,
        "agent_id": 1
    }
}
```

## üìä Codes de Statut

### Statuts des Militants
- `active` - Militant actif
- `inactive` - Militant inactif
- `suspended` - Militant suspendu

### Statuts de Paiement
- `paid` - Paiement effectu√©
- `unpaid` - Paiement en attente
- `pending` - Paiement en cours

### Statuts de V√©rification
- `en_cours` - V√©rification en cours
- `correct` - V√©rification valid√©e
- `refuse` - V√©rification refus√©e
- `corrige` - V√©rification corrig√©e

### Statuts d'Impression
- `printed` - Carte imprim√©e
- `not_printed` - Carte non imprim√©e

## ‚ùå Codes d'Erreur

### 400 - Bad Request
```json
{
    "message": "Les donn√©es fournies sont invalides",
    "errors": {
        "email": ["Le champ email est requis"],
        "password": ["Le mot de passe doit contenir au moins 8 caract√®res"]
    }
}
```

### 401 - Unauthorized
```json
{
    "message": "Non authentifi√©"
}
```

### 403 - Forbidden
```json
{
    "message": "Acc√®s refus√©"
}
```

### 404 - Not Found
```json
{
    "message": "Militant non trouv√©"
}
```

### 422 - Unprocessable Entity
```json
{
    "message": "Erreur de validation",
    "errors": {
        "email": ["L'email est d√©j√† utilis√©"]
    }
}
```

### 500 - Internal Server Error
```json
{
    "message": "Erreur interne du serveur"
}
```

## üîß Exemples d'Utilisation

### cURL - Connexion
```bash
curl -X POST http://localhost:8000/api/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "password123"
  }'
```

### cURL - Cr√©er un militant
```bash
curl -X POST http://localhost:8000/api/agents/militants \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "nom": "Doe",
    "prenom": "John",
    "email": "john@example.com",
    "telephone": "1234567890",
    "circonscription_id": 1,
    "departement_id": 1,
    "commune_id": 1
  }'
```

### JavaScript - Lister les militants
```javascript
fetch('http://localhost:8000/api/agents/militants', {
    headers: {
        'Authorization': 'Bearer YOUR_TOKEN',
        'Content-Type': 'application/json'
    }
})
.then(response => response.json())
.then(data => console.log(data));
```

## üìù Notes Importantes

1. **Authentification**: Tous les endpoints marqu√©s avec üîí n√©cessitent une authentification
2. **Pagination**: Les listes sont pagin√©es par d√©faut (15 √©l√©ments par page)
3. **Validation**: Tous les champs sont valid√©s c√¥t√© serveur
4. **Photos**: Les photos sont stock√©es dans `storage/app/public/photos/`
5. **R√©f√©rences**: Les cartes de r√©f√©rence sont g√©n√©r√©es automatiquement
6. **Relations**: Les relations g√©ographiques sont valid√©es (commune ‚Üí circonscription ‚Üí d√©partement)

## üîÑ Versioning

L'API utilise la versioning par URL. La version actuelle est v1 (implicite).

Exemple: `http://localhost:8000/api/v1/agents/militants`
